require('../config')
const { BufferJSON, WA_DEFAULT_EPHEMERAL, generateWAMessageFromContent, proto, generateWAMessageContent, generateWAMessage, prepareWAMessageMedia, areJidsSameUser, getContentType } = require('@adiwajshing/baileys')
const fs = require('fs')
const util = require('util')
const chalk = require('chalk')
const { exec, spawn, execSync } = require("child_process")
const axios = require('axios')
const path = require('path')
const os = require('os')
const moment = require('moment-timezone')
const { smsg, formatp, tanggal, formatDate, getTime, isUrl, sleep, clockString, fetchJson, getBuffer, jsonformat, format, parseMention, getRandom } = require('../lib/myfunc')
module.exports = bot = async (bot, m, chatUpdate, store) => {
try {
var body = (m.mtype === 'conversation') ? m.message.conversation : (m.mtype == 'imageMessage') ? m.message.imageMessage.caption : (m.mtype == 'videoMessage') ? m.message.videoMessage.caption : (m.mtype == 'extendedTextMessage') ? m.message.extendedTextMessage.text : (m.mtype == 'buttonsResponseMessage') ? m.message.buttonsResponseMessage.selectedButtonId : (m.mtype == 'listResponseMessage') ? m.message.listResponseMessage.singleSelectReply.selectedRowId : (m.mtype == 'templateButtonReplyMessage') ? m.message.templateButtonReplyMessage.selectedId : (m.mtype === 'messageContextInfo') ? (m.message.buttonsResponseMessage?.selectedButtonId || m.message.listResponseMessage?.singleSelectReply.selectedRowId || m.text) : ''
var budy = (typeof m.text == 'string' ? m.text : '')
var prefix = prefa ? /^[°•π÷×¶∆£¢€¥®™+✓_=|~!?@#$%^&.©^]/gi.test(body) ? body.match(/^[°•π÷×¶∆£¢€¥®™+✓_=|~!?@#$%^&.©^]/gi)[0] : "" : prefa ?? global.prefix
const isCmd = body.startsWith(prefix)
const pushname = m.pushName || "No Name"
const command = body.replace(prefix, '').trim().split(/ +/).shift().toLowerCase()
const args = body.trim().split(/ +/).slice(1)
const reply = (teks) => {
bot.sendMessage(m.chat, { text: teks })
}
if (!bot.public) {
if (!m.key.fromMe) return
}
if (m.message) {
bot.sendReadReceipt(m.chat, m.sender, [m.key.id])
console.log(chalk.green('[ MESSAGE UPDATE]'), 'From', chalk.green(pushname), 'Type', chalk.green(budy || m.mtype))
}
switch(command) {
case 'bot': 
reply('what bro :)')
break
case 'ttyo':
reply('Hehe ya boi')
break
case 'ttp':
reply('💥')
break
case 'ttd':
reply('💤')
break
case 'menu':
templateButtons = [
    {index: 1, urlButton: {displayText: '⭐ Star Baileys on GitHub!', url: 'https://github.com/HERMIT-SIR/whatsapp-bot-md'}},
    {index: 2, callButton: {displayText: 'Call me!', phoneNumber: '+0'}},
    {index: 3, quickReplyButton: {displayText: 'Good!', id: 'ttyo'}},
    {index: 4, quickReplyButton: {displayText: '😹!', id: 'ttp'}},
    {index: 5, quickReplyButton: {displayText: '🥱!', id: 'ttd'}},
]

templateMessage = {
    text: `Hi vro ${pushname}\nThis is just a testing bot :)`,
    footer: 'WhatsApp-bot-md',
    templateButtons: templateButtons
}

bot.sendMessage(m.chat, templateMessage)
break
default:
}
} catch (err) {
m.reply(util.format(err))
}}
let file = require.resolve(__filename)
fs.watchFile(file, () => {
fs.unwatchFile(file)
console.log(chalk.redBright(`Update ${__filename}`))
delete require.cache[file]
require(file)
})
